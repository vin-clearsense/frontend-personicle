import Head from 'next/head';
import styles from '../styles/Home.module.css';
import React, {useContext,useEffect,useState} from "react";
import AuthenticationContext from '../contexts/authentication';
import Link from 'next/link';
import dynamic from 'next/dynamic';
import config from './config';
import { useRouter } from 'next/router';


export default function Home() {
  const[oktaAuth,authState,name] = useContext(AuthenticationContext);

  const googleAuthorizeRoute = "https://dev-01936861.okta.com/oauth2/v1/authorize?idp="+config.idps.googleId+'&client_id='+config.oidc.clientId+'&response_type=code%20token%20id_token&response_mode=fragment&scope=openid%20email%20profile&redirect_uri='+config.idps.redirect_uri+'&state='+config.idps.state+'&nonce='+config.idps.nonce;
  const triggerSignOut = async () => {
   await  oktaAuth.signOut({  clearTokensBeforeRedirect :true ,postLogoutRedirectUri: 'http://localhost:3000/',});
  }

 const triggerLogin = async () => {
   oktaAuth.signInWithRedirect({ originalUri: '/' });
  }
  
  const handleRedirect =  async () => {
      await oktaAuth.handleLoginRedirect({originalUri: 'http://localhost:3000/'});
  }
 
  return (
    <div className={styles.container}>
      <Head>
        <title>Personicle</title>
        {/* <meta name="description" content="Generated by create next app" /> */}
        <link rel="icon" href="/favicon.ico" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0-beta/css/materialize.min.css"/>

        <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0-beta/js/materialize.min.js"></script>
      </Head> 

      <main className={styles.main}>
       {!authState && (
          <>
          Not signed in <br /> 
          <button onClick={triggerLogin}>Sign In With Okta</button> 
          
       <div className="col">
          <a className="oauth-container btn darken-4 white black-text" href={googleAuthorizeRoute} >
              <div className="left">
                  <img className="im" width="20px" alt="Google sign-in" 
                      src="https://upload.wikimedia.org/wikipedia/commons/thumb/5/53/Google_%22G%22_Logo.svg/512px-Google_%22G%22_Logo.svg.png" />
              </div>
              Sign in with Google
          </a>
          <style jsx>
            {`
              .col{
                margin-top: 7px;
              }
              .im{
                margin-right: 8px;
                margin-top: 7px;
              }
            `}
          </style>
       </div>
{/*            
            <div > 
                    <button>
              <Link href={googleAuthorizeRoute}>Sign In With Google</Link>
              </button>
          
          </div> */}
      
          </>
        )}
      {authState && (
          <>
          Welcome to the super awesome personicle {name} <br /> 
          
          <button onClick={triggerSignOut}>Sign Out </button> 
         
          <button>
            <Link href="/testPage">To the connections</Link>
          </button>
        
          </>
        )}

      </main>
    </div>
  )
}
